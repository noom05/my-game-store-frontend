<div class="container py-5">
  <!-- แสดง Spinner ขณะกำลังโหลดข้อมูลเริ่มต้น -->
  <div *ngIf="isLoading" class="text-center">
    <div class="spinner-border text-warning" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">กำลังโหลดข้อมูลเกม...</p>
  </div>

  <!-- แสดงฟอร์มเมื่อโหลดข้อมูลเสร็จแล้ว -->
  <form *ngIf="!isLoading && editGameForm" [formGroup]="editGameForm" (ngSubmit)="onSubmit()">
    <div class="form-section row align-items-stretch">
      
      <!-- รูปภาพเกมด้านซ้าย -->
      <div class="col-md-5">
        <input #fileInput type="file" (change)="onFileSelected($event)" accept="image/*" class="form-control d-none" />
        <label for="gameImage" class="d-block">
          <div id="imagePreview" (click)="fileInput.click()">
            <img *ngIf="imagePreview" [src]="imagePreview" alt="Game Image Preview" />
            <span *ngIf="!imagePreview" class="text-muted">คลิกเพื่ออัปโหลดรูปภาพใหม่</span>
          </div>
        </label>
      </div>

      <!-- ฟอร์มแก้ไขข้อมูลด้านขวา -->
      <div class="col-md-7">
          <div class="mb-3">
            <label class="form-label">ชื่อเกม</label>
            <input type="text" class="form-control" formControlName="game_name" />
          </div>
          <div class="mb-3">
            <label class="form-label">รายละเอียด</label>
            <textarea class="form-control" formControlName="description" rows="3"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">วันวางจำหน่าย</label>
            <input type="date" class="form-control" formControlName="release_date" />
          </div>

          <!-- Checkbox สำหรับประเภทเกม -->
          <div class="mb-3">
            <label class="form-label">ประเภทเกม</label>
            <div class="d-flex flex-wrap gap-3">
              <div *ngFor="let type of allTypes" class="form-check">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  [value]="type.id" 
                  [checked]="isChecked(type.id)"
                  (change)="onTypeChange($event)"
                  id="type-{{type.id}}">
                <label class="form-check-label" for="type-{{type.id}}">
                  {{ type.type_name }}
                </label>
              </div>
            </div>
          </div>
          
          <div class="mb-3">
            <label class="form-label">ราคา</label>
            <input type="number" class="form-control" formControlName="price" />
          </div>
          <div class="action-buttons d-flex justify-content-center gap-2">
            <button type="submit" class="btn btn-warning" [disabled]="editGameForm.invalid">บันทึกการเปลี่ยนแปลง</button>
            <a routerLink="/dashboard" class="btn btn-secondary">ยกเลิก</a>
          </div>
      </div>
    </div>
  </form>
</div>
